---
// This page handles the project URLs

import LayoutApp from '@layouts/LayoutApp.astro'
import { getProject, getTasks } from '@data/pocketbase'

const { project_id = '' } = Astro.params

import ButtonAddNewTask from '@components/app/tasks/ButtonAddNewTask.astro'

const project = await getProject(project_id)

// Redirects link back to the dashboard if project corresponding to the id fails 
if(!project) {
    return Astro.redirect('/app/dashboard')
}

const tasks = await getTasks(project_id)

import HamburgerMenuButton from '@components/app/HamburgerMenuButton.astro'

---

<LayoutApp title="{project.name}">
  <div class='mx-auto text-white max-w-7xl space-y-6'>
        <div class='rounded-lg bg-zinc-900 px-5 py-4 sm:py-2.5 text-xl sm:text-2xl md:text-3xl text-white uppercase text-center font-extrabold'>
          <div class='sm:hidden'>
            <HamburgerMenuButton />
          </div>
      {project.name} <!--Otherwise we show the project name in the UI -->
        </div>

        <div class='space-y-6'>
            <div
              class='p-10 text-white rounded-lg shadow bg-zinc-100 dark:bg-zinc-800'>
              <h2
                class='pb-10 text-xl font-black text-center uppercase text-zinc-800 dark:text-white'>
                Tasks to do 
              </h2>

              <div>
                {
                  tasks.length === 0 && ( //includes the part inside parentheses only if the condition is true. In this case we show “Nothing yet” if the tasks number is 0
                    <p class='text-center text-zinc-900 dark:text-white pb-10'>
                      Nothing yet
                    </p>
                  )
                }
      
                <ul class='space-y-6'>
                  {tasks.map(task => <li>{task.text}</li>)}
                </ul>
              </div>

              <ButtonAddNewTask project_id={project_id} /> <!--Add new button to page-->
            </div>
          </div>
    </div>
</LayoutApp>  